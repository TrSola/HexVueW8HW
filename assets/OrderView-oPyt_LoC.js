import{r as u,w as A,d as s,e as l,f as e,t as a,m as C,F as k,p as P,D as R,J as D,o as U,b as T,h as M,n as H}from"./index--5RmUa0K.js";import{a as w}from"./axios-L6U4YIEh.js";import{_ as I}from"./DelModal-shSf7ayd.js";import{u as B}from"./useModal-uaOw0Vy1.js";import{_ as N}from"./PaginationComponent-tHqa8yc7.js";import{a as m}from"./sweetAlertStore-yXRoe6Nu.js";import"./selector-engine-Le2foxcA.js";const j={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},z=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},W={class:"row"},J={class:"col-md-4"},G=e("h3",null,"用戶資料",-1),K={class:"table"},Q={key:0},X=e("th",{style:{width:"100px"}},"姓名",-1),Y=e("th",null,"Email",-1),Z=e("th",null,"電話",-1),ee=e("th",null,"地址",-1),te={class:"col-md-8"},se=e("h3",null,"訂單細節",-1),le={class:"table"},oe=e("th",{style:{width:"100px"}},"訂單編號",-1),ae=e("th",null,"下單時間",-1),ne=e("th",null,"付款時間",-1),de={key:0},ie={key:1},ue=e("th",null,"付款狀態",-1),re={key:0,class:"text-success"},ce={key:1,class:"text-muted"},_e=e("th",null,"總金額",-1),he=e("h3",null,"選購商品",-1),pe={class:"table"},ve=e("thead",null,[e("tr")],-1),me={class:"text-end"},fe={class:"d-flex justify-content-end"},be={class:"form-check"},ye={class:"form-check-label",for:"flexCheckDefault"},ke={key:0},$e={key:1},ge={class:"modal-footer"},Me=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),xe={__name:"OrderModal",props:{order:Object},emits:["update-paid"],setup(V,{expose:f,emit:b}){const{openModal:y,hideModal:x,modalRef:$}=B(),i=V,p=b,t=u({});return A(()=>i.order,r=>{t.value=r}),f({openModal:y,hideModal:x}),(r,_)=>(s(),l("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:$},[e("div",j,[e("div",q,[z,e("div",F,[e("div",W,[e("div",J,[G,e("table",K,[t.value.user?(s(),l("tbody",Q,[e("tr",null,[X,e("td",null,a(t.value.user.name),1)]),e("tr",null,[Y,e("td",null,a(t.value.user.email),1)]),e("tr",null,[Z,e("td",null,a(t.value.user.tel),1)]),e("tr",null,[ee,e("td",null,a(t.value.user.address),1)])])):C("",!0)])]),e("div",te,[se,e("table",le,[e("tbody",null,[e("tr",null,[oe,e("td",null,a(t.value.id),1)]),e("tr",null,[ae,e("td",null,a(r.$filters.date(t.value.create_at)),1)]),e("tr",null,[ne,e("td",null,[t.value.paid_date?(s(),l("span",de,a(r.$filters.date(t.value.paid_date)),1)):(s(),l("span",ie,"時間不正確"))])]),e("tr",null,[ue,e("td",null,[t.value.is_paid?(s(),l("strong",re,"已付款")):(s(),l("span",ce,"尚未付款"))])]),e("tr",null,[_e,e("td",null,a(r.$filters.currency(t.value.total)),1)])])]),he,e("table",pe,[ve,e("tbody",null,[(s(!0),l(k,null,P(t.value.products,n=>(s(),l("tr",{key:n.id},[e("th",null,a(n.product.title),1),e("td",null,a(n.qty)+" / "+a(n.product.unit),1),e("td",me,a(r.$filters.currency(n.final_total)),1)]))),128))])]),e("div",fe,[e("div",be,[R(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":_[0]||(_[0]=n=>t.value.is_paid=n)},null,512),[[D,t.value.is_paid]]),e("label",ye,[t.value.is_paid?(s(),l("span",ke,"已付款")):(s(),l("span",$e,"未付款"))])])])])])]),e("div",ge,[Me,e("button",{type:"button",class:"btn btn-primary",onClick:_[1]||(_[1]=n=>p("update-paid",t.value))}," 修改付款狀態 ")])])])],512))}};var we={VITE_APP_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_PATH:"aca101139",BASE_URL:"/HexVueW8HW/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Ce={class:"table mt-4"},Pe=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Ve=["textContent"],Ee={class:"list-unstyled"},Re={class:"text-right"},De={class:"form-check form-switch"},Oe=["id","onUpdate:modelValue","onChange"],Se=["for"],Le={key:0},Ae={key:1},Ue={class:"btn-group"},Te=["onClick"],He=["onClick"],We={__name:"OrderView",setup(V){const f=u(null),b=u(null),y=u({}),x=u(!1),$=u({}),i=u(!1),p=u({}),t=u({}),r=u(1),{VITE_APP_URL:_,VITE_APP_PATH:n}=we,g=(d=1)=>{const v=`${_}/api/${n}/admin/orders?page=${d}`;i.value=!0,w.get(v,t).then(h=>{y.value=h.data.orders,$.value=h.data.pagination,m.showSuccessMsg("已取得訂單資料")}).catch(h=>{m.showErrorMsg(h.response.data.message)}).finally(()=>{i.value=!1})},O=d=>{p.value={...d},x.value=!1,f.value.openModal()},S=d=>{p.value={...d},b.value.openModal()},E=d=>{const v=`${_}/api/${n}/admin/order/${d.id}`,h={is_paid:d.is_paid};i.value=!0,w.put(v,{data:h}).then(o=>{i.value=!1,f.value.hideModal(),g(r.value),m.showSuccessMsg("修改付款狀態成功")}).catch(o=>{i.value=!1,m.showErrorMsg(o.response.data.message)})},L=()=>{const d=`${_}/api/${n}/admin/order/${p.value.id}`;i.value=!0,w.delete(d).then(v=>{i.value=!1,b.value.hideModal(),g(r.value),m.showSuccessMsg("刪除訂單成功")}).catch(v=>{i.value=!1,m.showErrorMsg(v.response.data.message)})};return U(()=>{g()}),(d,v)=>{const h=T("VueLoading");return s(),l(k,null,[M(h,{active:i.value,"z-index":1060},null,8,["active"]),e("table",Ce,[Pe,e("tbody",null,[(s(!0),l(k,null,P(y.value,o=>(s(),l(k,{key:o.id},[y.value.length?(s(),l("tr",{key:0,class:H({"text-secondary":!o.is_paid})},[e("td",null,a(d.$filters.date(o.create_at)),1),e("td",null,[o.user?(s(),l("span",{key:0,textContent:a(o.user.email)},null,8,Ve)):C("",!0)]),e("td",null,[e("ul",Ee,[(s(!0),l(k,null,P(o.products,c=>(s(),l("li",{key:c.id},a(c.product.title)+" 數量："+a(c.qty)+" "+a(c.product.unit),1))),128))])]),e("td",Re,a(o.total),1),e("td",null,[e("div",De,[R(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,"onUpdate:modelValue":c=>o.is_paid=c,onChange:c=>E(o)},null,40,Oe),[[D,o.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${o.id}`},[o.is_paid?(s(),l("span",Le,"已付款")):(s(),l("span",Ae,"未付款"))],8,Se)])]),e("td",null,[e("div",Ue,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>O(o)}," 檢視 ",8,Te),e("button",{class:"btn btn-outline-warning btn-sm",type:"button",onClick:c=>S(o)}," 刪除 ",8,He)])])],2)):C("",!0)],64))),128))])]),M(xe,{order:p.value,ref_key:"orderModalRef",ref:f,onUpdatePaid:E},null,8,["order"]),M(I,{item:p.value,ref_key:"delModalRef",ref:b,onDelItem:L},null,8,["item"]),M(N,{pages:$.value,onEmitPages:g},null,8,["pages"])],64)}}};export{We as default};
