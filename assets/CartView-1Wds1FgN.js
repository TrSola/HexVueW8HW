import{i as x,a as s,b as o,f as t,t as r,F as P,m as S,j as i,q as T,v as I,s as L,o as H,r as N,d as D,u as c,w as j,y as z,e as k}from"./index-SsoGIBs4.js";import{u as F}from"./useModal-PwnjRtjZ.js";import{a as m}from"./axios-L6U4YIEh.js";import{S as g}from"./sweetAlertStore-CjVJMAZr.js";import{S as E}from"./sweetalert2.all-QRg5uDx8.js";import{u as O}from"./cartStore-wFFZikoA.js";const W={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content border-0"},J={class:"modal-header bg-dark text-white"},K={class:"modal-title",id:"exampleModalLabel"},Q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body"},Y={class:"row"},Z={class:"col-sm-6"},tt=["src"],et={class:"col-sm-6"},st={class:"badge bg-primary rounded-pill"},ot={key:0,class:"h5"},at={key:1,class:"h6"},nt={key:2,class:"h5"},lt={class:"input-group"},dt={__name:"UserProductModal",props:["product"],emits:["add-to-cart"],setup(V,{expose:_,emit:h}){const{openModal:$,hideModal:l,modalRef:M}=F(),u=V,C=h,y=x(1),d=()=>{C("add-to-cart",u.product.id,y.value),y.value=1};return _({openModal:$,hideModal:l}),(B,w)=>(s(),o("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:M},[t("div",W,[t("div",G,[t("div",J,[t("h5",K,[t("span",null,r(u.product.title),1)]),Q]),t("div",X,[t("div",Y,[t("div",Z,[(s(!0),o(P,null,S(u.product.imagesUrl,b=>(s(),o("img",{class:"img-fluid mb-2 object-fit-cover",src:b,alt:"",key:b.id,style:{height:"200px",width:"200px","background-size":"cover","padding-right":"5px"}},null,8,tt))),128))]),t("div",et,[t("span",st,r(u.product.category),1),t("p",null,"商品描述："+r(u.product.description),1),t("p",null,"商品內容："+r(u.product.content),1),u.product.price?i("",!0):(s(),o("div",ot,r(u.product.origin_price)+" 元 ",1)),u.product.price?(s(),o("del",at,"原價 "+r(u.product.origin_price)+" 元",1)):i("",!0),u.product.price?(s(),o("div",nt," 現在只要 "+r(u.product.price)+" 元 ",1)):i("",!0),t("div",null,[t("div",lt,[T(t("input",{type:"number",class:"form-control","onUpdate:modelValue":w[0]||(w[0]=b=>y.value=b),min:"1"},null,512),[[I,y.value,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:d}," 加入購物車 ")])])])])])])])],512))}};var ct={VITE_APP_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_PATH:"aca101139",BASE_URL:"/HexVueW8HW/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const it={class:"container"},rt={class:"mt-4"},ut={class:"table align-middle"},pt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),_t={style:{width:"200px"}},ht={key:0,class:"h5"},mt={key:1,class:"h6"},gt={key:2,class:"h5"},bt={class:"btn-group btn-group-sm"},vt=["onClick","disabled"],ft={key:0,class:"fas fa-spinner fa-pulse"},yt=["onClick","disabled"],kt={key:0,class:"fas fa-spinner fa-pulse"},xt={key:0,class:"text-end"},$t=t("h2",null,"試試放一項商品到購物車中吧",-1),Ct=[$t],Mt={key:1,class:"text-end"},wt={key:2,class:"table align-middle"},Pt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),St=["onClick","disabled"],Tt={key:0,class:"fas fa-spinner fa-pulse"},It={key:0,class:"text-success"},Vt={class:"input-group input-group-sm mb-1 mt-1"},Bt={class:"input-group"},Dt=["onUpdate:modelValue","onBlur","disabled"],Et={class:"input-group-text",id:"basic-addon2"},Ut={class:"text-end"},Rt={key:0,class:"text-success"},At=t("td",{colspan:"3",class:"text-end"},"總計",-1),qt={class:"text-end"},Lt={key:0},Ht=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Nt={class:"text-end text-success"},jt={key:3,class:"input-group mb-3 input-group-sm"},zt=t("p",{class:"text-muted"},'輸入優惠碼"迷你奧利給"全站商品享5折優惠',-1),Ft={key:4,class:"d-flex justify-content-end mb-5"},Xt={__name:"CartView",setup(V){const{VITE_APP_URL:_,VITE_APP_PATH:h}=ct,$=x(null),l=x({loadingItem:""}),M=x([]),u=x({}),C=x(""),y=O(),{carts:d}=L(y),B=()=>{const n=`${_}/api/${h}/products`;m.get(n).then(a=>{M.value=a.data.products}).catch(a=>{alert(a.response.data.message)})},w=n=>{const a=`${_}/api/${h}/product/${n}`;l.value.loadingItem=n,m.get(a).then(p=>{u.value=p.data.product,$.value.openModal(),l.value.loadingItem=""}).catch(p=>{alert(p.response.data.message)})},b=(n,a=1)=>{const p=`${_}/api/${h}/cart`;l.value.loadingItem=n;const e={product_id:n,qty:a};$.value.hideModal(),m.post(p,{data:e}).then(()=>{v(),g.showSuccessMsg("已加入購物車"),l.value.loadingItem=""}).catch(f=>{alert(f.response.data.message)})},U=n=>{l.value.loadingItem=n.id;const a=`${_}/api/${h}/cart/${n.id}`,p={product_id:n.product_id,qty:n.qty};m.put(a,{data:p}).then(()=>{g.showSuccessMsg("已更新購物車"),v(),l.value.loadingItem=""}).catch(e=>{alert(e.response.data.message),l.value.loadingItem=""})},R=()=>{E.fire({title:"是否清空購物車?",showDenyButton:!0,confirmButtonText:"確認清空",denyButtonText:"再想想好了"}).then(a=>{a.isConfirmed?(g.showSuccessMsg("刪除成功"),m.delete(n).then(()=>{v()}).catch(p=>{alert(p.response.data.message)})):a.isDenied&&g.showErrorMsg("已為您保留購物車")}).catch(()=>{alert("伺服器錯誤")});const n=`${_}/api/${h}/carts`},v=()=>{const n=`${_}/api/${h}/cart`;m.get(n).then(a=>{d.value=a.data.data}).catch(a=>{alert(a.response.data.message)})},A=n=>{E.fire({title:"確認要刪除",showDenyButton:!0,confirmButtonText:"確認刪除",denyButtonText:"再想想好了"}).then(p=>{p.isConfirmed?(l.value.loadingItem=n,g.showSuccessMsg("刪除成功"),m.delete(a).then(()=>{v(),l.value.loadingItem=""}).catch(e=>{alert(e.response.data.message)})):p.isDenied&&g.showErrorMsg("已為您保留該品項")});const a=`${_}/api/${h}/cart/${n}`},q=()=>{const n=`${_}/api/${h}/coupon`,a={code:C.value};m.post(n,{data:a}).then(p=>{g.showSuccessMsg("已加入優惠券"),v(),l.value.loadingItem=""}).catch(()=>{g.showErrorMsg("加入優惠券失敗"),v(),l.value.loadingItem=""})};return H(()=>{B(),v()}),(n,a)=>{const p=N("router-link");return s(),o("div",it,[t("div",rt,[D(dt,{ref_key:"userProductModalRef",ref:$,product:u.value,onAddToCart:b},null,8,["product"]),t("table",ut,[pt,t("tbody",null,[(s(!0),o(P,null,S(M.value,e=>(s(),o("tr",{key:e.id},[t("td",_t,[t("div",{style:z([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${e.imageUrl})`}])},null,4)]),t("td",null,r(e.title),1),t("td",null,[e.price?i("",!0):(s(),o("div",ht,r(e.origin_price)+" 元 ",1)),e.price?(s(),o("del",mt,"原價 "+r(e.origin_price)+" 元",1)):i("",!0),e.price?(s(),o("div",gt," 現在只要 "+r(e.price)+" 元 ",1)):i("",!0)]),t("td",null,[t("div",bt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:f=>w(e.id),disabled:l.value.loadingItem===e.id||!e.is_enabled},[l.value.loadingItem===e.id?(s(),o("i",ft)):i("",!0),k(" 查看更多 ")],8,vt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:f=>b(e.id),disabled:l.value.loadingItem===e.id||!e.is_enabled},[l.value.loadingItem===e.id?(s(),o("i",kt)):i("",!0),k(" 加到購物車 ")],8,yt)])])]))),128))])]),c(d).carts&&c(d).carts.length===0?(s(),o("div",xt,Ct)):(s(),o("div",Mt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:R}," 清空購物車 ")])),c(d).carts&&c(d).carts.length!==0?(s(),o("table",wt,[Pt,t("tbody",null,[c(d).carts?(s(!0),o(P,{key:0},S(c(d).carts,e=>(s(),o("tr",{key:e.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:f=>A(e.id),disabled:l.value.loadingItem===e.id},[l.value.loadingItem===e.id?(s(),o("i",Tt)):i("",!0),k(" x ")],8,St)]),t("td",null,[k(r(e.product.title)+" ",1),e.coupon?(s(),o("div",It," 已套用優惠券 ")):i("",!0)]),t("td",null,[t("div",Vt,[t("div",Bt,[T(t("input",{"onUpdate:modelValue":f=>e.qty=f,onBlur:f=>U(e),disabled:l.value.loadingItem===e.id,min:"1",type:"number",class:"form-control"},null,40,Dt),[[I,e.qty,void 0,{number:!0}]]),t("span",Et,r(e.product.unit),1)])])]),t("td",Ut,[c(d).final_total!==c(d).total?(s(),o("small",Rt,"折扣價：")):i("",!0),k(" "+r(Math.floor(c(d).final_total)),1)])]))),128)):i("",!0)]),t("tfoot",null,[t("tr",null,[At,t("td",qt,r(c(d).total),1)]),c(d).final_total!==c(d).total?(s(),o("tr",Lt,[Ht,t("td",Nt,r(Math.floor(c(d).final_total)),1)])):i("",!0)])])):i("",!0),c(d).carts&&c(d).carts.length!==0?(s(),o("div",jt,[T(t("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),placeholder:"請輸入優惠碼"},null,512),[[I,C.value]]),t("div",{class:"input-group-append"},[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:q}," 套用優惠碼 ")])])):i("",!0),zt,c(d).carts&&c(d).carts.length!==0?(s(),o("div",Ft,[D(p,{to:"/checkOut",class:"btn btn-dark"},{default:j(()=>[k("現在去結帳")]),_:1})])):i("",!0)])])}}};export{Xt as default};
